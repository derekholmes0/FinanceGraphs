---
output: github_document
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# FinanceGraphs

<!-- badges: start -->
<!-- badges: end -->

A flexible wrapper around [dygraphs] and [ggplot2] to graph and annototate financial time series data.  The package provides several ways to add additional information
to a simple series vs time data, including horizontal annotations (events highligted by lines and colored bands) and vertical annotations (key levels
or regions).  Colors and set of labels can be customized and persist across invocations of the package, but sensible dfaults are used. 
To minimize verbiage to get what you want, the package emphasizes options in the main function call rather than multiple functions or pipes to build up a graph.


## Installation

You can install the development version of FinanceGraphs from 

```{r, eval=F}
pak::pak("derekholmes0/FinanceGraphs")
# install.packages("FinanceGraphs")  # If from CRAN
```
## Input data

The package is designed to be flexile with input data.  The data can either be in **long** format (e.g. `date`,`series`,`value`) or **wide** format (date,col1,col2,...).  
The `date` column can be called anything or be anywhere in the input data.frame, but there must be at least one coercible column with dates and one
numeric column.  Each column after the date column is treated as a separate series to be graphed, but if the column name (series name) ends in any of
'`.lo`, `.hi`, `.f` (for forecast), '`.flo`, `.fhi` then those columns are treated specially as lower/upper bands or forecast series associated with 
the prefix of the name.

## Simple Examples

```{r, eval=T}
library(FinanceGraphs)
fgts_dygraph(eqtypx, title="Stock Prices", ylab="Adjusted Close")
```
* All of the data is displayed on the graph by default, but nost of the time, we want to focus on recent periods and have the option of backing up to all history.
The `dtstartfrac` parameter shows just the last (1-`dtstartfrac`) percent of the data.  Alternatively, a *generic date window* of the form "start::end" can be 
used in the `dtwindow` parameter. Each end of the window can be a full date (e.g. "2022-01-01") or a relative date string (e.g. "-6m" for 6 months ago.

* One of the most appealing features of [dygraphs] is the ability to smooth series interactively.  The `roller` parameter adds a rolling average smoother 
of the specified width (in data points).  A default smoothing parameter is chosen depending on the length of the underlying data, but can be overridden using the
`roller` parameter.

* Individual series can be altered in several ways:

  - Highlighted with different stroke patterns and width using the `hilightcols` argument with a string (possibly list) of series names, `hilightwidth` for a new width, and `hilightstyle` for a new stroke pattern.
  - Shown a step plot using the `stepcols` argument with a string (possibly list) of series names.
  - Hidden from using the `hidecols` argument with a string (possibly list) of series names.

```{r, eval=T}
fgts_dygraph(eqtypx, dtstartfrac=0.8,hilightcols="IBM",hilightwidth=4,roller=3)
```

## Events

Annotations to a particular date or date range can be added to the graph using the `events` and `event_ds` parameters.  
The `events` parameter is a string with one or more (separated by semicolons) event specifications.  The `event_ds` parameter is an optional data.frame with user defined events. (See Vignette for examples)
Any events specified with either parameter are additive. 

### Events in the function call

Simple examples of events specified in the function call include.

```{r, eval=T}
smalldta <- narrowbydtstr(eqtypx[,.(date,TLT,EEM)],"-3y::")
fgts_dygraph(smalldta,events="doi,regm;doi,fedmoves")
fgts_dygraph(smalldta,events="date,FOMO,2025-01-01,2025-06-01;date,xmas,2025-12-25")
```

### Event helpers


## Other annnotations

## Forecasts


```

